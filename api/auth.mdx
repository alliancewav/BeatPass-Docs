---
title: "Authentication"
description: "How authentication works on the BeatPass API using Laravel Sanctum."
---

## Overview

BeatPass uses **Laravel Sanctum** for API authentication. Sanctum provides a simple token-based authentication system for SPAs (single-page applications) and mobile applications.

<Note>
  BeatPass does not use OAuth or issue third-party API keys. Authentication is for first-party BeatPass applications only.
</Note>

---

## Authentication Methods

### Session-Based (Web SPA)

The BeatPass web application uses cookie-based session authentication:

1. User logs in via `/login` endpoint
2. Laravel creates an authenticated session
3. Subsequent requests include session cookie
4. CSRF protection applies to mutating requests

### Token-Based (API)

For direct API access, use Bearer token authentication:

```http
Authorization: Bearer YOUR_SANCTUM_TOKEN
```

---

## Obtaining Tokens

### Web Login

Users authenticate through the standard login flow:

<Steps>
  <Step title="Navigate to Login">
    Go to `https://beta.beatpass.ca/login`
  </Step>
  
  <Step title="Enter Credentials">
    Provide email and password.
  </Step>
  
  <Step title="Two-Factor (if enabled)">
    Enter TOTP code from authenticator app.
  </Step>
  
  <Step title="Session Created">
    Authenticated session begins with cookie.
  </Step>
</Steps>

### API Token Generation

Sanctum tokens can be created for authenticated users:

```http
POST /api/sanctum/token
Content-Type: application/json

{
  "email": "user@example.com",
  "password": "your-password",
  "device_name": "my-app"
}
```

**Response:**

```json
{
  "token": "1|abc123...",
  "user": {
    "id": 123,
    "email": "user@example.com",
    "display_name": "Username"
  }
}
```

<Warning>
  Store tokens securely. Never expose them in client-side code, URLs, or logs.
</Warning>

---

## Using Tokens

### Bearer Token Header

Include the token in the Authorization header:

```bash
curl -X GET "https://beta.beatpass.ca/api/v1/user-profile/123" \
  -H "Accept: application/json" \
  -H "Authorization: Bearer 1|abc123..."
```

### Example Authenticated Request

```javascript
const response = await fetch('https://beta.beatpass.ca/api/v1/purchases', {
  headers: {
    'Accept': 'application/json',
    'Authorization': `Bearer ${token}`
  }
});
```

---

## Optional vs Required Auth

### Optional Auth Endpoints

Many endpoints use `optionalAuth:sanctum` middlewareâ€”they work without authentication but return more data when authenticated:

```http
GET /tracks           # Public track list
GET /tracks/{id}      # Track details (shows purchase status if authed)
GET /artists/{id}     # Artist profile (shows follow status if authed)
GET /search           # Search results
```

### Required Auth Endpoints

These endpoints require a valid token:

```http
POST /tracks                           # Upload track
PUT  /tracks/{track}                   # Update track
POST /tracks/{track}/purchase/initiate # Purchase flow
GET  /purchases                        # User purchases
GET  /messaging/conversations          # Messages
POST /beat-requests                    # Create request
GET  /producer-intelligence/dashboard  # Analytics
```

---

## Two-Factor Authentication

When 2FA is enabled, the login flow requires an additional step:

### Initial Login Response (2FA Required)

```json
{
  "two_factor": true,
  "message": "Two factor authentication required"
}
```

### Submit 2FA Code

```http
POST /two-factor-challenge
Content-Type: application/json

{
  "code": "123456"
}
```

Or use a recovery code:

```json
{
  "recovery_code": "abcd-efgh-ijkl"
}
```

---

## Token Security

### Best Practices

<AccordionGroup>
  <Accordion title="Store Securely">
    Use secure storage (Keychain, encrypted preferences). Never localStorage for sensitive apps.
  </Accordion>
  
  <Accordion title="HTTPS Only">
    All API requests must use HTTPS. Tokens sent over HTTP can be intercepted.
  </Accordion>
  
  <Accordion title="Token Revocation">
    Revoke tokens when logging out or if compromise is suspected.
  </Accordion>
  
  <Accordion title="Short-Lived Sessions">
    Web sessions expire based on server configuration. Re-authenticate as needed.
  </Accordion>
</AccordionGroup>

### Revoking Tokens

Users can revoke all tokens from account settings, or revoke specific sessions.

---

## Authentication Errors

| Status | Meaning | Solution |
|--------|---------|----------|
| 401 | Unauthenticated | Token missing, invalid, or expired |
| 403 | Forbidden | User lacks permission for this resource |
| 419 | Session Expired | CSRF token mismatch (web SPA) |

### Error Response

```json
{
  "message": "Unauthenticated."
}
```

---

## Social Login

BeatPass supports social authentication providers:

| Provider | Available |
|----------|-----------|
| Google | Yes |
| Facebook | Yes |
| Apple | Yes |

Social logins create a BeatPass account and session automatically.

---

## Next Steps

<CardGroup cols={2}>
  <Card title="API Endpoints" icon="code" href="/api/endpoints">
    See available endpoints.
  </Card>
  <Card title="Rate Limits" icon="gauge" href="/api/rate-limits">
    Understand request limits.
  </Card>
</CardGroup>
